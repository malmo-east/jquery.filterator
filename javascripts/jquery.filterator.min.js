(function($){$.fn.filterator=function(opts){return this.each(function(){if(!opts.target)throw new Error("No target. I don't know what to filter");if(!opts.container)throw new Error("No container. I don't know where to apply the filter");var el=$(this),container=$(opts.container),target=opts.target;if(!container.data("has-filters")){container.bind("filter",function(){var $t=$(this);elements=$t.children();var data=$t.data(),filters={};for(key in data){var filter=key.match(/^filter(.*?)$/);if(filter)filters[filter[1].toLowerCase()]=
data[key]}elements.hide();elements.filter(function(){for(filter in filters)if($(this).data(filter)!=filters[filter]&&!$(this).data(filter).match("#"+filters[filter]+"#"))return false;return true}).show()});container.data("has-filters",true)}if(el.get(0).tagName=="SELECT")el.change(function(){var filter=$(this).val();if(filter)container.data("filter-"+target,filter);else container.removeData("filter-"+target);container.trigger("filter")});else el.delegate("a","click",function(e){e.preventDefault();
var $t=$(this);if($t.hasClass("selected"))return;var filter=$(this).data("filter");if(filter)container.data("filter-"+target,filter);else container.removeData("filter-"+target);$t.siblings().removeClass("selected");$t.addClass("selected");container.trigger("filter")})})}})(jQuery);